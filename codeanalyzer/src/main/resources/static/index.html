<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Code Analyzer</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f0f4f8;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
    }
    .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        width: 400px;
    }
    h2 {
        text-align: center;
        color: #333;
    }
    input, textarea {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
    }
    button:hover {
        background: #0056b3;
    }
    .result {
        margin-top: 20px;
        font-weight: bold;
        color: green;
    }
</style>
</head>
<body>

<div class="container">
    <h2>Code Analyzer</h2>

    <div id="login-section">
        <input type="text" id="username" placeholder="Enter your name" required>
        <input type="email" id="email" placeholder="Enter your email" required>
        <button onclick="registerUser()">Register</button>
    </div>

    <div id="code-section" style="display:none;">
        <textarea id="codeText" rows="6" placeholder="Paste your Java code here"></textarea>
        <button onclick="submitCode()">Analyze Code</button>
        <div class="result" id="result"></div>
    </div>
</div>

<script>
    let userId = null;

    function registerUser() {
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        if (!username || !email) {
            alert("Please fill both name and email!");
            return;
        }

        fetch('/api/users', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, email })
        })
        .then(res => res.json())
        .then(data => {
        	console.log(data);
            userId = data.id;
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('code-section').style.display = 'block';
        })
        .catch(err => alert('Registration failed'));
    }

    function submitCode() {
        const codeText = document.getElementById('codeText').value.trim();

        fetch('/api/codesubmit?userId=' + userId, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(codeText)
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById('result').innerHTML = `
                <p>Analysis Score: ${data.analysisScore}</p>
                <p>Issues Found: ${data.issuesFound}</p>
                <p>Submitted At: ${data.createdAt}</p>
            `;
        })
        .catch(err => alert('Code submission failed'));
    }
</script>
